<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tabla de Clasificación | Torneo de Youtubers CoD Mobile</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Estilos generales con fondo de imagen */
        body {
            background-color: #121212; /* Fallback si la imagen no carga */
            color: #7e7e7e; /* Texto gris claro */
            font-family: 'Arial', sans-serif;
            padding-top: 20px;
            margin: 0;
            position: relative; /* Para el overlay */
            overflow-x: hidden; /* Evita scroll horizontal si la imagen es muy ancha */
            min-height: 100vh;
        }

        /* Fondo de imagen */
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('https://r2.fivemanage.com/XTC0OA0z5LKkI1Ialy4w2/WhatsAppImage2025-10-06at2.15.48PM.jpeg'); /* ¡AQUÍ VA LA IMAGEN! */
            background-size: cover;
            background-position: center;
            filter: brightness(30%) blur(2px); /* Oscurecer y desenfocar la imagen */
            z-index: -1; /* Mover el fondo detrás del contenido */
        }
        
        /* Contenedor principal para que el contenido flote sobre el fondo */
        main, header {
            position: relative;
            z-index: 1;
        }

        /* Encabezado */
        .header-bg {
            background-color: rgba(0, 0, 0, 0.6); /* Fondo semi-transparente oscuro */
            padding: 20px 0;
            margin-bottom: 40px;
            border-bottom: 3px solid #FFC107; /* Línea de acento (Amarillo/Oro) */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.6);
        }

        /* Estilo del logo y título */
        .tournament-logo {
            max-height: 100px; /* Altura de tu logo */
            width: auto;
            display: block;
            margin: 0 auto;
        }
        .scoreboard-title {
            color: #FFC107;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 3px;
            text-shadow: 1px 1px 5px rgba(0, 0, 0, 1);
            margin-top: 15px;
            font-size: 2.5rem; /* Título más grande */
        }
        
        /* Contenedor de la tabla */
        #leaderboard-container {
            background-color: rgba(0, 0, 0, 0.7); /* Fondo semi-transparente para la tabla */
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(255, 193, 7, 0.3); /* Sombra dorada más prominente */
            overflow-x: auto; 
        }

        /* Estilo de la tabla Bootstrap para que se vea como LATAM SHOWDOWN */
        .table-custom {
            --bs-table-bg: transparent; /* Fondo transparente para la tabla */
            --bs-table-color: #969696; /* Texto blanco */
            --bs-table-border-color: #444; /* Bordes un poco más claros */
            font-size: 1.2rem; /* Tamaño de fuente más grande para filas */
        }
        .table-custom th {
            color: #FFC107; /* Encabezados amarillos */
            border-bottom: 3px solid #FFC107; /* Borde más grueso */
            text-transform: uppercase;
            font-size: 1rem; /* Encabezado de la tabla */
            padding: 1rem 0.5rem;
        }
        .table-custom td {
            padding: 0.8rem 0.5rem;
            vertical-align: middle; /* Centra verticalmente el texto */
        }
        .table-custom tr:nth-child(even) {
            background-color: rgba(255, 255, 255, 0.05); /* Fila alterna semi-transparente */
        }
        /* Color especial para la columna Slot */
        .table-custom td:first-child { 
            font-weight: bold;
            color: #505050; /* Naranja/Rojo de acento, si quieres Top 1, Top 2, etc. */
            font-size: 1.3rem; /* Slot ligeramente más grande */
        }
        /* Para destacar el Top 3, puedes agregar estas clases en JS */
        .table-custom tr:nth-child(1) td { color: gold; font-weight: bold; }
        .table-custom tr:nth-child(2) td { color: silver; font-weight: bold; }
        .table-custom tr:nth-child(3) td { color: #aa6321; font-weight: bold; } /* Bronce */

        .text-muted {
            color: rgba(255, 255, 255, 0.5) !important;
        }
    </style>
</head>
<body>

    <header class="header-bg">
        <div class="container text-center">
            <img 
                 src="https://r2.fivemanage.com/XTC0OA0z5LKkI1Ialy4w2/logooficial.png" 
                alt="Logo del Torneo" 
                class="tournament-logo"
            >
            
            <h1 class="scoreboard-title">TABLA DE PUNTAJES OFICIAL</h1>
        </div>
    </header>

    <main class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-xl-8"> 
                <div class="alert alert-info text-center" role="alert" id="loading-message">
                    Cargando clasificación...
                </div>
                
                <div id="leaderboard-container">
                    </div>
            </div>
        </div>
        
        <div class="text-center mt-5 mb-3 text-muted">
            <small>Torneo de Youtubers CoD Mobile. Los puntajes se actualizan al editar la hoja de cálculo.</small>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
    // !!! REEMPLAZA ESTA URL BASE CON TU ENLACE DE PUBLICACIÓN DE HOJA DE CÁLCULO !!!
    const SPREADSHEET_URL_BASE = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vR9_-sFuodCsbmOWmGSLmHx17etlF5jdl8bo_fy5nPPQ9NFcZCfr1xmMf_K31962J0GIXcpmokAXIJ6/pub?gid=591116041&single=true&output=csv';
    
    // El proxy de AllOrigins sigue siendo necesario para evitar problemas de CORS.

    const MAX_ROWS_DISPLAY = 10; // Mostrar solo las primeras 10 filas (Top 10)

    const container = document.getElementById('leaderboard-container');
    const loadingMessage = document.getElementById('loading-message');

    function csvToArray(text) {
        // ... (Tu función csvToArray actual - No es necesario modificarla)
        let p = '';
        let row = [''];
        let ret = [row];
        let i = 0;
        let r = 0;
        let s = !0;

        for (let j = 0; j < text.length; j++) {
            let c = text[j];
            if (c === '"' && s) {
                s = !s;
            } else if (c === '"' && !s) {
                if (text[j + 1] === '"') {
                    row[i] += c;
                    j++;
                } else {
                    s = !s;
                }
            } else if (c === ',' && s) {
                c = row[++i] = '';
            } else if (c === '\n' && s) {
                if (text[j - 1] === '\r') {
                    row[i] = row[i].slice(0, -1);
                }
                row = ret[++r] = [''];
                i = 0;
            } else {
                row[i] += c;
            }
        }
        return ret.filter(r => r[0] !== '');
    }

    async function loadLeaderboard() {
        // 1. Agregar una marca de tiempo al final de la URL de la hoja de cálculo.
        // Esto crea una URL única en cada solicitud, forzando la actualización.
        const cacheBuster = `&t=${new Date().getTime()}`;
        const finalSpreadsheetUrl = SPREADSHEET_URL_BASE + cacheBuster;

        // 2. Codificar la URL con el cacheBuster para AllOrigins
        const CSV_URL = 'https://api.allorigins.win/raw?url=' + encodeURIComponent(finalSpreadsheetUrl);
        
        try {
            const response = await fetch(CSV_URL);
            const csvText = await response.text();
            const data = csvToArray(csvText);

            loadingMessage.style.display = 'none';

            if (data.length <= 1) {
                container.innerHTML = '<div class="alert alert-warning">No se encontraron datos de clasificación.</div>';
                return;
            }

            let html = '<table class="table table-custom"><thead><tr>';

            // Encabezados (primera fila del CSV)
            const headers = data[0];
            headers.forEach(header => {
                html += `<th scope="col">${header.trim().toUpperCase()}</th>`;
            });
            html += '</tr></thead><tbody>';

            // Datos (limitando a MAX_ROWS_DISPLAY)
            const rowsToDisplay = Math.min(data.length - 1, MAX_ROWS_DISPLAY);
            for (let i = 1; i <= rowsToDisplay; i++) {
                const row = data[i];
                html += `<tr>`;
                row.forEach((cell, cellIndex) => {
                    let cellClass = '';
                    if (cellIndex === 0) { // Columna SLOT
                        cellClass = 'fw-bold';
                    }
                    // Aplicar colores al Top 3
                    if (i === 1 && cellIndex !== 0) { 
                        cellClass += ' text-warning'; // Dorado
                    } else if (i === 2 && cellIndex !== 0) {
                        cellClass += ' text-light'; // Plateado
                    } else if (i === 3 && cellIndex !== 0) {
                        cellClass += ' text-info'; // Bronce
                    }
                    html += `<td class="${cellClass}">${cell.trim()}</td>`;
                });
                html += '</tr>';
            }

            html += '</tbody></table>';
            container.innerHTML = html;

        } catch (error) {
            console.error("Error al cargar la clasificación:", error);
            loadingMessage.className = 'alert alert-danger text-center';
            loadingMessage.innerHTML = 'Error al cargar la clasificación. Verifica la URL o los permisos.';
            loadingMessage.style.display = 'block';
        }
    }

    // Llama a la función al cargar la página
    loadLeaderboard();
    
    // ** OPCIONAL: Actualizar la tabla automáticamente cada 30 segundos **
    // Si la tabla debe actualizarse automáticamente, descomenta la siguiente línea:
    // setInterval(loadLeaderboard, 30000); 

</script>
</body>
</html>